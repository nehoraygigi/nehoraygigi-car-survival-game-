<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×¡×™××•×œ×¦×™×™×ª ×”×™×©×¨×“×•×ª: ×¨×›×‘ ×©×•×§×¢ - HARDCORE</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; background: #010409; color: white; user-select: none; }
        canvas { display: block; }
        .ui-panel { position: absolute; pointer-events: none; width: 100%; height: 100%; top: 0; left: 0; display: flex; flex-direction: column; justify-content: space-between; padding: 20px; z-index: 10; }
        .interactive { pointer-events: auto; }
        .glass-panel { background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 12px; padding: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .btn { transition: all 0.2s; cursor: pointer; border-radius: 8px; font-weight: bold; padding: 14px 20px; text-align: center; border: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn:hover { background-color: rgba(255,255,255,0.1); transform: translateY(-2px); border-color: rgba(255,255,255,0.4); }
        .btn:active { transform: scale(0.95); }
        #message-overlay { position: absolute; top: 25%; left: 50%; transform: translate(-50%, -50%); pointer-events: none; text-align: center; width: 85%; opacity: 0; transition: opacity 0.4s; z-index: 20; }
        #message-overlay.show { opacity: 1; }
        #end-screen { position: absolute; inset: 0; z-index: 100; display: none; flex-direction: column; align-items: center; justify-content: center; background: radial-gradient(circle, #0a192f 0%, #000 100%); text-align: center; padding: 20px; }
        .fail-bg { background: radial-gradient(circle, #4a0000 0%, #000 100%) !important; }
        .win-bg { background: radial-gradient(circle, #002200 0%, #000 100%) !important; }
    </style>
</head>
<body>

    <!-- ××¡×š ×¡×™×•× -->
    <div id="end-screen">
        <h1 id="end-title" class="text-6xl font-black mb-4 italic uppercase tracking-tighter"></h1>
        <p id="end-sub" class="text-2xl mb-8 max-w-2xl leading-relaxed"></p>
        <div class="bg-black/40 p-8 rounded-2xl mb-10 border border-white/10 backdrop-blur-md">
            <p class="font-bold text-yellow-400 mb-4 text-lg">×¤×¨×•×˜×•×§×•×œ ×”×™×©×¨×“×•×ª ××¦×™×œ ×—×™×™×:</p>
            <div class="flex flex-wrap justify-center gap-4 text-xl font-bold italic">
                <span class="bg-white/10 px-3 py-1 rounded">ğŸªŸ ×—×œ×•×Ÿ</span> 
                <span>â¬…ï¸</span> 
                <span class="bg-white/10 px-3 py-1 rounded">ğŸ—ï¸ ×—×’×•×¨×”</span> 
                <span>â¬…ï¸</span> 
                <span class="bg-white/10 px-3 py-1 rounded">ğŸ‘¶ ×™×œ×“×™×</span> 
                <span>â¬…ï¸</span> 
                <span class="bg-white/10 px-3 py-1 rounded">ğŸŠ ×”×—×•×¦×”</span>
            </div>
        </div>
        <button id="reset-btn" class="interactive bg-white text-black px-16 py-5 rounded-xl font-black text-2xl hover:scale-105 transition-all shadow-2xl">
            × ×¡×” ×©×•×‘
        </button>
    </div>

    <!-- ×××©×§ ××©×ª××© -->
    <div id="ui-layer" class="ui-panel">
        <div class="flex justify-between items-start">
            <div class="glass-panel w-72">
                <div class="flex justify-between items-center mb-3 border-b border-white/10 pb-2">
                    <span class="font-black text-red-500 tracking-wider uppercase">Hardcore Mode</span>
                    <span id="stat-power-icon" class="text-green-500">âš¡ ON</span>
                </div>
                <div class="space-y-3">
                    <div>
                        <div class="flex justify-between text-xs mb-1 opacity-70"><span>××¤×œ×¡ ××™×</span><span id="stat-water-text">× ××•×š</span></div>
                        <div class="w-full bg-gray-800 h-2 rounded-full overflow-hidden">
                            <div id="bar-water" class="bg-blue-600 h-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-bold opacity-70">×–××Ÿ ×©× ×•×ª×¨:</span>
                        <span id="stat-time" class="font-mono text-xl font-black">40.0s</span>
                    </div>
                </div>
            </div>
            
            <div class="glass-panel text-center min-w-[150px]">
                <div id="stage-title" class="text-lg font-black text-yellow-400">×©×œ×‘ 1: ×”×¤×’×™×¢×”</div>
            </div>
        </div>

        <div id="message-overlay">
            <div class="glass-panel inline-block px-10 py-5 border-red-500/50">
                <p id="message-text" class="text-xl font-bold text-white leading-relaxed"></p>
            </div>
        </div>

        <div id="action-container" class="flex justify-center flex-wrap gap-4 interactive mb-12">
            <!-- ×›×¤×ª×•×¨×™× ×™×™×•×•×¦×¨×• ×›××Ÿ -->
        </div>
    </div>

    <script>
        const INITIAL_STATE = { 
            stage: 1, 
            time: 40, 
            waterLevel: 0, 
            waterY: -3, 
            isGameOver: false, 
            power: true,
            beltReleased: false,
            kidsSaved: false
        };

        let state = { ...INITIAL_STATE };
        let scene, camera, renderer, car, water;

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x01040a);
            scene.fog = new THREE.FogExp2(0x01040a, 0.08);

            camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(6, 4, 10);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            const ambient = new THREE.AmbientLight(0xffffff, 0.4);
            scene.add(ambient);
            const light = new THREE.PointLight(0x4488ff, 2);
            light.position.set(5, 5, 5);
            scene.add(light);

            createWorld();
            updateActions();
            
            document.getElementById('reset-btn').addEventListener('click', reset);
            window.addEventListener('resize', onResize);
            
            loop();
        }

        function createWorld() {
            if(car) scene.remove(car);
            if(water) scene.remove(water);

            car = new THREE.Group();
            // Body
            const body = new THREE.Mesh(new THREE.BoxGeometry(4, 1.2, 2.2), new THREE.MeshPhongMaterial({ color: 0x660000 }));
            body.position.y = 0.6;
            car.add(body);
            // Cabin
            const glass = new THREE.Mesh(new THREE.BoxGeometry(2.2, 1, 1.9), new THREE.MeshPhongMaterial({ color: 0x3399ff, transparent: true, opacity: 0.4 }));
            glass.position.set(-0.2, 1.6, 0);
            car.add(glass);
            scene.add(car);

            water = new THREE.Mesh(new THREE.PlaneGeometry(300, 300), new THREE.MeshPhongMaterial({ color: 0x002244, transparent: true, opacity: 0.8 }));
            water.rotation.x = -Math.PI / 2;
            water.position.y = state.waterY;
            scene.add(water);
        }

        function updateActions() {
            const container = document.getElementById('action-container');
            container.innerHTML = '';
            
            if (state.stage === 1) {
                btn("ğŸšª ×¤×ª×— ×“×œ×ª (××”×¨!)", "bg-gray-700", () => act('fail', "×”×“×œ×ª ×œ× × ×¤×ª×—×”. ×œ×—×¥ ×”××™× ×‘×—×•×¥ (×××•×ª ×§×™×œ×•×’×¨××™×) × ×¢×œ ××•×ª×” ×¤×™×–×™×ª. ××™×‘×“×ª ××ª ×—×œ×•×Ÿ ×”×–××Ÿ ×•×™×›×•×œ×ª ×”×¤×¢×•×œ×”."));
                btn("ğŸªŸ ×¤×ª×— ×—×œ×•×Ÿ (×—×©××œ×™)", "bg-blue-600", () => act('win_stage', "××¢×•×œ×”! ×”×—×œ×•×Ÿ × ×¤×ª×—. ×›×¢×ª ×¤×¢×œ ××”×¨ ×œ×©×—×¨×•×¨ ×”×—×’×•×¨×” ×•×”× ×•×¡×¢×™×."));
                btn("ğŸ“± ×”×ª×§×©×¨ ×œ××©×˜×¨×”", "bg-gray-700", () => act('fail', "×‘×–××Ÿ ×©×”××ª× ×ª ×œ××¢× ×”, ×”××™× ×”×’×™×¢×• ×œ××¢×¨×›×ª ×”×—×©××œ ×•× ×¢×œ×• ××ª ×”×—×œ×•× ×•×ª. ×˜×‘×¢×ª ×‘×ª×•×š ×”×¨×›×‘ ×”××œ×›×•×“×ª."));
            } else if (state.stage === 2) {
                btn("ğŸ—ï¸ ×©×—×¨×¨ ×—×’×•×¨×ª ×‘×˜×™×—×•×ª", "bg-yellow-600", () => {
                    state.beltReleased = true;
                    act('win_stage', "×”×—×’×•×¨×” ×©×•×—×¨×¨×”. ×¢×›×©×™×• ×—×œ×¥ ××ª ×”×™×œ×“×™× ××”×›×™×¡× ×××—×•×¨!");
                });
                btn("ğŸŠ ×§×¤×•×¥ ×”×—×•×¦×” ××™×“", "bg-gray-700", () => act('fail', "×©×›×—×ª ×©××ª×” ×¢×“×™×™×Ÿ ×§×©×•×¨ ×‘×—×’×•×¨×”! ×”××™× ×”×¦×™×¤×• ××ª ×”×¨×›×‘ ×‘×‘×ª ××—×ª ×•×œ× ×”×¦×œ×—×ª ×œ×”×©×ª×—×¨×¨ ×ª×—×ª ×œ×—×¥."));
            } else if (state.stage === 3) {
                btn("ğŸ§’ ×©×—×¨×¨ ×™×œ×“×™× ×××—×•×¨", "bg-purple-600", () => {
                    state.kidsSaved = true;
                    act('win_stage', "×”×™×œ×“×™× ××©×•×—×¨×¨×™×! ×¢×›×©×™×• ×–×” ×”×–××Ÿ ×œ×¦××ª ×•×œ×©×—×•×ª ×œ××¢×œ×”.");
                });
                btn("ğŸŠ ×¦× ×œ×‘×“ ××”×—×œ×•×Ÿ", "bg-gray-700", () => act('fail', "× ×™×¡×™×ª ×œ×”×¦×™×œ ××ª ×¢×¦××š ××š ×”×™×œ×“×™× × ×•×ª×¨×• ×××—×•×¨. ×‘×œ×—×¥ ×•×”×¤×× ×™×§×” ×©× ×•×¦×¨×”, ×œ× ×”×¦×œ×—×ª ×œ×—×–×•×¨ ×¤× ×™××” ×œ×”×¦×™×œ×."));
            } else if (state.stage === 4) {
                btn("ğŸ«§ ×©×—×” ×œ×›×™×•×•×Ÿ ×”×‘×•×¢×•×ª", "bg-green-600", () => win("×©×¨×“×ª! ×¢×§×‘×ª ××—×¨×™ ×‘×•×¢×•×ª ×”××•×•×™×¨ ××œ ×¤× ×™ ×”×©×˜×—. ×–×• ×”×“×¨×š ×”×™×—×™×“×” ×œ×“×¢×ª ××™×¤×” '×œ××¢×œ×”' ×‘××™× ×¢×›×•×¨×™×."));
                btn("ğŸŒ‘ ×©×—×” ×œ×›×™×•×•×Ÿ ×”×—×•×©×š", "bg-gray-800", () => act('fail', "××™×‘×“×ª ×”×ª××¦××•×ª ×‘××™× ×¢×›×•×¨×™× ×•×©×—×™×ª ×‘×˜×¢×•×ª ×œ×›×™×•×•×Ÿ ×”×§×¨×§×¢×™×ª. ××–×œ ×œ×š ×”××•×•×™×¨."));
            }
        }

        function btn(text, color, onClick) {
            const b = document.createElement('div');
            b.className = `${color} btn text-white shadow-lg interactive`;
            b.innerText = text;
            b.onclick = onClick;
            document.getElementById('action-container').appendChild(b);
        }

        function act(type, msg) {
            if (state.isGameOver) return;
            if (type === 'fail') {
                gameOver(msg);
            } else if (type === 'win_stage') {
                state.stage++;
                flash(msg);
                updateActions();
            }
        }

        function loop() {
            if (!state.isGameOver) {
                state.time -= 0.05;
                state.waterLevel += 0.25; // ××¤×œ×¡ ×¢×•×œ×” ××”×¨ (40 ×©× ×™×•×ª)
                state.waterY = -3 + (state.waterLevel * 0.06);
                water.position.y = state.waterY;
                car.rotation.z = Math.sin(Date.now() * 0.001) * 0.05;

                document.getElementById('stat-time').innerText = Math.max(0, state.time).toFixed(1) + 's';
                document.getElementById('bar-water').style.width = Math.min(100, state.waterLevel) + '%';

                if (state.time <= 0) gameOver("×”×–××Ÿ ××–×œ. ×”×¨×›×‘ ×©×§×¢ ×œ×’××¨×™ ×‘×§×¨×§×¢×™×ª.");
                if (state.waterLevel > 100 && state.stage < 4) {
                    gameOver("×”×¨×›×‘ ×”×•×¦×£ ×œ×’××¨×™ ×œ×¤× ×™ ×©×”×¡×¤×§×ª ×œ×‘×¦×¢ ××ª ×›×œ ×©×œ×‘×™ ×”×—×™×œ×•×¥.");
                }

                const names = ["", "×”×¤×’×™×¢×”", "×©×—×¨×•×¨ ×—×’×•×¨×”", "×—×™×œ×•×¥ ×™×œ×“×™×", "×”×™×—×œ×¦×•×ª"];
                document.getElementById('stage-title').innerText = `×©×œ×‘ ${state.stage}: ${names[state.stage]}`;
            }
            renderer.render(scene, camera);
            requestAnimationFrame(loop);
        }

        function flash(text) {
            const overlay = document.getElementById('message-overlay');
            const msg = document.getElementById('message-text');
            msg.innerText = text;
            overlay.classList.add('show');
            setTimeout(() => overlay.classList.remove('show'), 2500);
        }

        function gameOver(msg) {
            state.isGameOver = true;
            document.getElementById('end-screen').classList.remove('win-bg');
            document.getElementById('end-screen').classList.add('fail-bg');
            end("ğŸ’€ × ×¤×¡×œ×ª!", msg);
        }

        function win(msg) {
            state.isGameOver = true;
            document.getElementById('end-screen').classList.remove('fail-bg');
            document.getElementById('end-screen').classList.add('win-bg');
            end("ğŸ† ×©×¨×“×ª!", msg);
        }

        function end(title, sub) {
            document.getElementById('end-title').innerText = title;
            document.getElementById('end-sub').innerText = sub;
            document.getElementById('end-screen').style.display = 'flex';
        }

        function reset() {
            state = { ...INITIAL_STATE };
            document.getElementById('end-screen').style.display = 'none';
            createWorld();
            updateActions();
        }

        function onResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        window.onload = init;
    </script>
</body>
</html>
